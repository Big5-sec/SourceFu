

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction &mdash; SourceFu 0 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://big5-sec.github.io/introduction.html"/>
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Some state of the art" href="some state of the art.html" />
    <link rel="prev" title="Welcome to SourceFu’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/SourceFu.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.01
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#about">About</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sourcefu-overview">SourceFu overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#genesis-of-the-project">genesis of the project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-this-really-about-so">What is this really about so?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wait-so-you-re-using-java">Wait, so you’re using java?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limitations">Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="some state of the art.html">Some state of the art</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="user manual.html">User manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="functioning.html">Functioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="planned features.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SourceFu</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<div class="section" id="about">
<h2>About<a class="headerlink" href="#about" title="Permalink to this headline">¶</a></h2>
<p>For source code intellectual property or to evade antivirus signatures, more and more programs get obfuscated from the source code. Famous legal examples are the use of <a class="reference external" href="https://www.guardsquare.com/en/products/proguard">Proguard</a> for android applications or <a class="reference external" href="https://www.usenix.org/conference/woot13/workshop-program/presentation/kholia">Dropbox client</a> . SourceFu is a tool that trying to provide a generic source to source deobfuscator, for malware analysts, reversers or simply curious people. Why generic? First, because SourceFu aims at providing support for multiple languages obfuscation. Second because deobfuscation methods employed should be adaptable to every language.</p>
<p>The documentation tries to cover the whole project :</p>
<ul class="simple">
<li>In this page, the genesis of the project, as well as a little insight of SourceFu features and limitations will be presented. A bit more in-depth analysis of why SourceFu could be interesting is presented <a class="reference internal" href="some state of the art.html"><span class="doc">there</span></a></li>
<li>A quickstart guide is presented <a class="reference internal" href="quickstart.html"><span class="doc">there</span></a></li>
<li>An user manual is given <a class="reference internal" href="user manual.html"><span class="doc">there</span></a></li>
<li>the methodology used by the tool is then explained <a class="reference internal" href="functioning.html"><span class="doc">here</span></a>. Beware, this pagemightnot be up to date.</li>
<li>Current ideas to improve SourceFu are presented <a class="reference internal" href="planned features.html"><span class="doc">here</span></a></li>
<li>Wanna contribute? please see the <span class="xref std std-doc">contributing guide</span> as well as the <a class="reference internal" href="development guide.html"><span class="doc">development guide</span></a>.</li>
</ul>
</div>
<div class="section" id="sourcefu-overview">
<h2>SourceFu overview<a class="headerlink" href="#sourcefu-overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="genesis-of-the-project">
<h3>genesis of the project<a class="headerlink" href="#genesis-of-the-project" title="Permalink to this headline">¶</a></h3>
<p>I was once asked at work to evaluate Cuckoo Sandbox project, especially to determine if the latter’s analyses are correct or not. In my tests, i used some handmade scripts that I obfuscated using the <a class="reference external" href="https://https://github.com/danielbohannon/Invoke-Obfuscation">invoke-obfuscation framework</a> made by Daniel Bohannon. Especially, a first observation leaded to the fact that Cuckoo sandbox is not able to deobfuscate properly scripts :</p>
<a class="reference internal image-reference" href="_images/cuckoo.png"><img alt="_images/cuckoo.png" class="align-center" src="_images/cuckoo.png" style="width: 752.0px; height: 342.0px;" /></a>
<p>Later on, while still assessing some tests on Cuckoo, a misplaced ‘rm -r’ leaded to the erasure of my original powershell scripts but not the obfuscated ones. In order to retrieve them (bad forensic guy, yeah i know), i planned so to deobfuscate the scripts that i still have. And there, the FU came! There was no deobfuscator for powershell, and i had to do the whole shit by hand….</p>
<a class="reference internal image-reference" href="_images/rage.jpg"><img alt="_images/rage.jpg" class="align-center" src="_images/rage.jpg" style="width: 263.6px; height: 148.2px;" /></a>
<p>From there, i first started to work on a simple pattern matching powershell deobfuscator, which to be honest was kind of bad : some regex should be matched if we are outside strings, but not inside; a powershel’s “replace” should work only on the string to be replaced and not on a variable name, etc… The regex became so more and more complex while i was developing it, and the whole thing was a harsh to maintain.</p>
<p>I decided so to move on another approach : why not use a grammar and a parser? More, what if i want to evaluate expressions in order to provide a more complete deobfuscation?</p>
<p>From those questions emerged the SourceFu project… whose name is composed of “source”, because only source obfuscation techniques are treated by the tool, and “Fu” because of my rage when i needed to deobfuscate those powershell scripts.</p>
</div>
<div class="section" id="what-is-this-really-about-so">
<h3>What is this really about so?<a class="headerlink" href="#what-is-this-really-about-so" title="Permalink to this headline">¶</a></h3>
<p>SourceFu aims at becoming a complete source deobfuscation framework. The current work has been focused on using partial evaluation and middle-front compilers optimizations, for VBA and Javascript, as well as a bit of Powershell. While the tool is quite in its infancy, many works and ideas from other people could be implemented. Hopefully, this tool could become one of the de-facto tool for source deobfuscation in future, with an active community around it.</p>
<p>It’s presented as one jar that can be used in three different manners :</p>
<ul class="simple">
<li>a command line tool, that is providing a way to invoke sourcefu routines on an input.</li>
<li>an api server, using REST, also invoking background routines</li>
<li>a full web server, presenting a graphical interface. This we server uses the API server and a database to work.</li>
</ul>
<p>Here is an example of using SourceFu CLI :</p>
<a class="reference internal image-reference" href="_images/sourcefu_exemple.gif"><img alt="_images/sourcefu_exemple.gif" class="align-center" src="_images/sourcefu_exemple.gif" style="width: 674.0px; height: 428.5px;" /></a>
</div>
<div class="section" id="wait-so-you-re-using-java">
<h3>Wait, so you’re using java?<a class="headerlink" href="#wait-so-you-re-using-java" title="Permalink to this headline">¶</a></h3>
<p>Hell yeah. I started the projet by doing everythin in python, because i love this language. However, antlr runtime is really slow in python, and i don’t know why. For example, let’s take the following script gathered on the net :</p>
<p>To simply parse this script (and only parse it) in python given the used grammar in SourceFu, i need :</p>
<a class="reference internal image-reference" href="_images/sourcefu_java_vs_python.png"><img alt="_images/sourcefu_java_vs_python.png" class="align-center" src="_images/sourcefu_java_vs_python.png" style="width: 487.2px; height: 68.6px;" /></a>
<p>Also, i did not want to code the whole thing in languages such as C/C++, because SourceFu basically manipulates strings, and strings management in C is quite a nightmare. By the way, i was not able to make functioning programs using C++ runtime of antlr, as outputs from antlr do not compile.</p>
<p>So, the original language used by antlr (and normally fully supported), java, was chosen, even if i hate it. For the comparison, here is the time needed to parse the same script i parsed with python, while still initializing the whole JVM and while in a VM :</p>
<a class="reference internal image-reference" href="_images/sourcefu_java_vs_python2.png"><img alt="_images/sourcefu_java_vs_python2.png" class="align-center" src="_images/sourcefu_java_vs_python2.png" style="width: 588.0px; height: 67.2px;" /></a>
<p>Finally, Java is almost learnt in every programming school in the world, and is cross-platform. And as an example, almost every pentester in the world right now uses <a class="reference external" href="https://portswigger.net/">Burp</a>, which is developed in java.</p>
</div>
<div class="section" id="limitations">
<h3>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h3>
<p>Deobfuscation is a NP-complete problem. In “understandable” words, you won’t be able to retrieve the original script for sure.</p>
<p>Indeed, let’s say you have “var4” as a variable name within a script, which is then obfuscated to “AzsXX1LiOo0pm”. It’s impossible to determine actually if the original name was actually “var4” instead of “var1”. Retrieving comments are not possible too.</p>
</div>
<div class="section" id="disclaimer">
<h3>Disclaimer<a class="headerlink" href="#disclaimer" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>SourceFu is still in an experimental state. Results might be wrong, tool might as well crash.</li>
<li>Deobfuscation is an hard subject, the work is huge.</li>
<li>This project is only developed on my spare time. Any help from you (even simply giving samples on which SourceFu does not work or telling me about syntax errors in this documentation) will be really appreciated!</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="some state of the art.html" class="btn btn-neutral float-right" title="Some state of the art" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to SourceFu’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2019, Zilio Nicolas

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>